 - hosts: all
   tasks:
    - name: List project directory on the test system
      command: ls -al {{ansible_user_dir}}/{{zuul.project.src_dir}}
    - name: install deps
      become: yes
      package:
        name:
          - 'koji'
          - 'python3-devel'
          - 'python3-koji'
          - 'python3-pytest'
          - 'python3-pytest-cov'
          - 'rpm-build'
        state: present
    - name: build source tarball
      command: chdir={{ansible_user_dir}}/{{zuul.project.src_dir}} python setup.py sdist
    - name: run rpmbuild on the tarball to produce both srpm and rpms
      shell: chdir={{ansible_user_dir}}/{{zuul.project.src_dir}} rpmbuild -ta dist/rpmautospec-*.tar.gz
